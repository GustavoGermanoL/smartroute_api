<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartRoute - Motorista</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card-entrega { margin-bottom: 15px; border-left: 5px solid #ccc; }
        .status-PENDENTE { border-left-color: #ffc107; }
        .status-ROTEIRIZADO { border-left-color: #0d6efd; }
        .status-ENTREGUE { border-left-color: #198754; opacity: 0.6; }
        .btn-navegar { width: 100%; margin-top: 5px; }
        .ordem-badge { font-size: 1.2em; font-weight: bold; width: 40px; text-align: center; }
    </style>
</head>
<body class="bg-light">

<div class="container py-3">
    <h3 class="mb-3 text-center">üöö Minha Rota de Hoje</h3>
    
    <div class="d-flex justify-content-between mb-3">
        <button onclick="carregarRota()" class="btn btn-primary">üîÑ Atualizar Lista</button>
        <span id="total-entregas" class="badge bg-secondary align-self-center">0 pacotes</span>
    </div>

    <div id="lista-entregas">
        <div class="text-center mt-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p>Carregando rota otimizada...</p>
        </div>
    </div>
</div>

<script>
    const API_URL = '/entregas'; // Chama seu Backend local

    async function carregarRota() {
        try {
            const response = await fetch(API_URL);
            const entregas = await response.json();
            
            // Filtra apenas as que t√™m ordem definida (roteirizadas)
            const rota = entregas.filter(e => e.ordemNaRota != null)
                                 .sort((a, b) => a.ordemNaRota - b.ordemNaRota);

            document.getElementById('total-entregas').innerText = rota.length + " pacotes";
            const container = document.getElementById('lista-entregas');
            container.innerHTML = '';

            if (rota.length === 0) {
                container.innerHTML = '<div class="alert alert-warning">Nenhuma rota calculada. Fa√ßa o upload e roteirize primeiro!</div>';
                return;
            }

            rota.forEach(entrega => {
                const html = `
                    <div class="card card-entrega shadow-sm status-${entrega.status}">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <div class="bg-dark text-white rounded-circle p-2 ordem-badge">
                                        ${entrega.ordemNaRota}
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="card-title m-0">${entrega.logradouro}, ${entrega.numero}</h5>
                                    <small class="text-muted">Pacote: ${entrega.codigoPacote}</small>
                                </div>
                            </div>
                            
                            <hr class="my-2">
                            
                            <div class="row g-2">
                                <div class="col-6">
                                    <a href="https://www.google.com/maps/dir/?api=1&destination=${entrega.latitude},${entrega.longitude}" 
                                       target="_blank" class="btn btn-outline-primary btn-sm btn-navegar">
                                       üó∫Ô∏è Google Maps
                                    </a>
                                </div>
                                <div class="col-6">
                                    <a href="https://waze.com/ul?ll=${entrega.latitude},${entrega.longitude}&navigate=yes" 
                                       target="_blank" class="btn btn-outline-info btn-sm btn-navegar">
                                       üöó Waze
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });

        } catch (error) {
            console.error('Erro:', error);
            document.getElementById('lista-entregas').innerHTML = 
                '<div class="alert alert-danger">Erro ao carregar rota. O servidor est√° rodando?</div>';
        }
    }

    // Carrega ao abrir a p√°gina
    carregarRota();
</script>

</body>
</html>